<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ConfidentialPayroll ‚Äî FHE Demo | Built for Zama</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=DM+Serif+Display:ital@0;1&family=IBM+Plex+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #030508;
    --bg2: #060c12;
    --surface: #0a1520;
    --border: #0f2a3f;
    --green: #00ff88;
    --cyan: #00d4ff;
    --gold: #ffcc44;
    --red: #ff4466;
    --text: #c8e0f0;
    --muted: #4a6a80;
    --glow-green: 0 0 20px rgba(0,255,136,0.4);
    --glow-cyan: 0 0 20px rgba(0,212,255,0.4);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'IBM Plex Mono', monospace;
    min-height: 100vh;
    overflow-x: hidden;
    cursor: crosshair;
  }

  /* Matrix rain canvas */
  #matrixCanvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    opacity: 0.04;
    pointer-events: none;
    z-index: 0;
  }

  /* Noise overlay */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E");
    opacity: 0.15;
    pointer-events: none;
    z-index: 1;
  }

  .container {
    position: relative;
    z-index: 2;
    max-width: 1100px;
    margin: 0 auto;
    padding: 0 24px;
  }

  /* ===================== HERO ===================== */
  header {
    padding: 60px 0 40px;
    text-align: center;
    position: relative;
  }

  .badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: rgba(0,255,136,0.08);
    border: 1px solid rgba(0,255,136,0.3);
    border-radius: 2px;
    padding: 6px 16px;
    font-size: 11px;
    color: var(--green);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 28px;
    animation: pulse-border 2s ease infinite;
  }

  @keyframes pulse-border {
    0%,100% { border-color: rgba(0,255,136,0.3); }
    50% { border-color: rgba(0,255,136,0.8); box-shadow: 0 0 20px rgba(0,255,136,0.2); }
  }

  .badge-dot {
    width: 7px; height: 7px;
    background: var(--green);
    border-radius: 50%;
    animation: blink 1.2s ease infinite;
  }

  @keyframes blink {
    0%,100% { opacity: 1; }
    50% { opacity: 0.2; }
  }

  h1 {
    font-family: 'DM Serif Display', serif;
    font-size: clamp(42px, 7vw, 82px);
    line-height: 0.95;
    letter-spacing: -2px;
    margin-bottom: 16px;
    background: linear-gradient(135deg, #ffffff 30%, var(--cyan) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  h1 em {
    font-style: italic;
    background: linear-gradient(135deg, var(--green) 0%, var(--cyan) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .tagline {
    font-size: 14px;
    color: var(--muted);
    letter-spacing: 1px;
    margin-bottom: 50px;
  }

  .tagline span { color: var(--cyan); }

  /* Prize bar */
  .prize-strip {
    display: flex;
    justify-content: center;
    gap: 40px;
    flex-wrap: wrap;
    margin-bottom: 60px;
  }

  .prize-item {
    text-align: center;
  }

  .prize-val {
    font-family: 'DM Serif Display', serif;
    font-size: 32px;
    color: var(--gold);
    text-shadow: 0 0 30px rgba(255,204,68,0.5);
  }

  .prize-label {
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-top: 4px;
  }

  /* ===================== FLOW SECTION ===================== */
  .section-label {
    font-size: 10px;
    letter-spacing: 4px;
    text-transform: uppercase;
    color: var(--green);
    margin-bottom: 12px;
  }

  .section-title {
    font-family: 'DM Serif Display', serif;
    font-size: clamp(28px, 4vw, 42px);
    color: #fff;
    margin-bottom: 8px;
    line-height: 1.1;
  }

  .section-sub {
    font-size: 13px;
    color: var(--muted);
    margin-bottom: 40px;
    max-width: 500px;
  }

  /* ===================== LIVE DEMO ===================== */
  .demo-wrapper {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 80px;
    position: relative;
  }

  .demo-wrapper::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--cyan), transparent);
  }

  .demo-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    background: rgba(0,212,255,0.03);
  }

  .demo-dot { width: 10px; height: 10px; border-radius: 50%; }
  .demo-dot.r { background: #ff5f56; }
  .demo-dot.y { background: #ffbd2e; }
  .demo-dot.g { background: #27c93f; }

  .demo-title {
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 2px;
    margin-left: 8px;
  }

  .demo-body {
    display: grid;
    grid-template-columns: 1fr 1fr;
    min-height: 480px;
  }

  @media (max-width: 700px) {
    .demo-body { grid-template-columns: 1fr; }
  }

  /* Left panel - controls */
  .demo-controls {
    padding: 28px;
    border-right: 1px solid var(--border);
  }

  .step-indicator {
    display: flex;
    gap: 6px;
    margin-bottom: 28px;
  }

  .step-dot {
    width: 24px; height: 4px;
    background: var(--border);
    border-radius: 2px;
    transition: all 0.3s;
    cursor: pointer;
  }

  .step-dot.active { background: var(--green); box-shadow: var(--glow-green); }
  .step-dot.done { background: var(--cyan); }

  .step-title {
    font-family: 'DM Serif Display', serif;
    font-size: 22px;
    color: #fff;
    margin-bottom: 8px;
  }

  .step-desc {
    font-size: 12px;
    color: var(--muted);
    line-height: 1.7;
    margin-bottom: 24px;
  }

  /* Input fields */
  .field-group { margin-bottom: 16px; }
  .field-label {
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 6px;
  }

  .field-input {
    width: 100%;
    background: rgba(0,0,0,0.4);
    border: 1px solid var(--border);
    border-radius: 2px;
    padding: 10px 14px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 13px;
    color: var(--text);
    outline: none;
    transition: border-color 0.2s;
  }

  .field-input:focus { border-color: var(--cyan); }

  .field-select {
    width: 100%;
    background: rgba(0,0,0,0.4);
    border: 1px solid var(--border);
    border-radius: 2px;
    padding: 10px 14px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 13px;
    color: var(--text);
    outline: none;
    cursor: pointer;
  }

  .btn-primary {
    width: 100%;
    padding: 14px;
    background: transparent;
    border: 1px solid var(--green);
    border-radius: 2px;
    color: var(--green);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 13px;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
  }

  .btn-primary::before {
    content: '';
    position: absolute;
    top: 0; left: -100%;
    width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(0,255,136,0.15), transparent);
    transition: left 0.4s;
  }

  .btn-primary:hover::before { left: 100%; }
  .btn-primary:hover {
    background: rgba(0,255,136,0.08);
    box-shadow: var(--glow-green);
  }

  .btn-primary:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  /* Right panel - visualization */
  .demo-visual {
    padding: 28px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    background: rgba(0,0,0,0.2);
  }

  .visual-label {
    font-size: 10px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 8px;
  }

  /* Cipher animation */
  .cipher-box {
    background: rgba(0,0,0,0.5);
    border: 1px solid var(--border);
    border-radius: 2px;
    padding: 16px;
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    color: var(--green);
    min-height: 80px;
    position: relative;
    overflow: hidden;
    word-break: break-all;
    line-height: 1.6;
  }

  .cipher-box.encrypting {
    border-color: var(--cyan);
    box-shadow: 0 0 15px rgba(0,212,255,0.2);
  }

  .cipher-box.done-encrypt {
    border-color: var(--green);
    box-shadow: 0 0 15px rgba(0,255,136,0.2);
  }

  .cipher-tag {
    position: absolute;
    top: 8px; right: 8px;
    font-size: 9px;
    letter-spacing: 2px;
    padding: 2px 8px;
    border: 1px solid currentColor;
    border-radius: 1px;
  }

  .cipher-tag.enc { color: var(--green); }
  .cipher-tag.plain { color: var(--gold); }
  .cipher-tag.computing { color: var(--cyan); }

  /* FHE operation chain */
  .fhe-chain {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .fhe-op {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    background: rgba(0,0,0,0.4);
    border: 1px solid var(--border);
    border-radius: 2px;
    font-size: 11px;
    opacity: 0.4;
    transition: all 0.4s;
  }

  .fhe-op.active {
    opacity: 1;
    border-color: var(--cyan);
    box-shadow: 0 0 10px rgba(0,212,255,0.15);
  }

  .fhe-op.done {
    opacity: 1;
    border-color: var(--green);
  }

  .fhe-op-icon {
    width: 28px; height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    flex-shrink: 0;
    background: var(--surface);
    border: 1px solid currentColor;
  }

  .fhe-op.active .fhe-op-icon { color: var(--cyan); border-color: var(--cyan); }
  .fhe-op.done .fhe-op-icon { color: var(--green); border-color: var(--green); }

  .fhe-op-text { flex: 1; }
  .fhe-op-name { color: #fff; margin-bottom: 2px; }
  .fhe-op-code { font-size: 10px; color: var(--muted); font-family: 'Space Mono', monospace; }

  .fhe-result {
    font-size: 11px;
    color: var(--green);
    font-family: 'Space Mono', monospace;
  }

  /* Result panel */
  .result-panel {
    background: rgba(0,255,136,0.04);
    border: 1px solid rgba(0,255,136,0.2);
    border-radius: 2px;
    padding: 16px;
    display: none;
  }

  .result-panel.visible { display: block; animation: fadeIn 0.4s ease; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  .result-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 0;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    font-size: 12px;
  }

  .result-row:last-child { border-bottom: none; }
  .result-key { color: var(--muted); }
  .result-val { color: var(--green); font-weight: 700; }
  .result-val.encrypted { color: var(--cyan); font-size: 10px; font-family: 'Space Mono', monospace; }
  .result-val.gold { color: var(--gold); }

  /* ===================== ARCHITECTURE ===================== */
  .arch-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 16px;
    margin-bottom: 80px;
  }

  .contract-card {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 24px;
    position: relative;
    overflow: hidden;
    transition: all 0.3s;
  }

  .contract-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0;
    width: 3px; height: 100%;
    background: var(--green);
    transform: scaleY(0);
    transform-origin: bottom;
    transition: transform 0.3s;
  }

  .contract-card:hover::before { transform: scaleY(1); }
  .contract-card:hover { border-color: rgba(0,255,136,0.3); transform: translateX(4px); }

  .contract-card.payslip::before { background: var(--cyan); }
  .contract-card.oracle::before { background: var(--gold); }
  .contract-card.token::before { background: var(--red); }

  .contract-card:hover.payslip { border-color: rgba(0,212,255,0.3); }
  .contract-card:hover.oracle { border-color: rgba(255,204,68,0.3); }
  .contract-card:hover.token { border-color: rgba(255,68,102,0.3); }

  .contract-icon {
    font-size: 28px;
    margin-bottom: 12px;
  }

  .contract-name {
    font-family: 'DM Serif Display', serif;
    font-size: 18px;
    color: #fff;
    margin-bottom: 6px;
  }

  .contract-lines {
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 2px;
    margin-bottom: 12px;
  }

  .contract-desc {
    font-size: 12px;
    color: var(--muted);
    line-height: 1.7;
    margin-bottom: 16px;
  }

  .contract-ops {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .op-tag {
    font-size: 10px;
    padding: 3px 8px;
    border: 1px solid var(--border);
    border-radius: 1px;
    color: var(--muted);
    font-family: 'Space Mono', monospace;
  }

  /* ===================== PAYSLIP DEMO ===================== */
  .payslip-demo {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 32px;
    margin-bottom: 80px;
    position: relative;
  }

  .payslip-demo::after {
    content: 'VERIFIABLE CONFIDENTIAL PAYSLIP';
    position: absolute;
    top: -10px; left: 50%;
    transform: translateX(-50%);
    font-size: 9px;
    letter-spacing: 4px;
    color: var(--cyan);
    background: var(--bg2);
    padding: 0 12px;
  }

  .payslip-grid {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 24px;
    align-items: center;
  }

  @media (max-width: 600px) {
    .payslip-grid { grid-template-columns: 1fr; }
    .payslip-arrow { transform: rotate(90deg); }
  }

  .payslip-party {
    background: rgba(0,0,0,0.3);
    border: 1px solid var(--border);
    border-radius: 2px;
    padding: 20px;
    text-align: center;
  }

  .party-icon { font-size: 36px; margin-bottom: 8px; }
  .party-name { font-family: 'DM Serif Display', serif; font-size: 16px; color: #fff; }
  .party-desc { font-size: 11px; color: var(--muted); margin-top: 4px; }

  .payslip-arrow {
    text-align: center;
    color: var(--cyan);
    font-size: 24px;
    flex-shrink: 0;
  }

  .proof-box {
    text-align: center;
    padding: 16px;
    background: rgba(0,212,255,0.06);
    border: 1px solid rgba(0,212,255,0.2);
    border-radius: 2px;
  }

  .proof-title { font-size: 12px; color: var(--cyan); margin-bottom: 8px; letter-spacing: 1px; }
  .proof-range {
    font-family: 'DM Serif Display', serif;
    font-size: 22px;
    color: #fff;
    margin-bottom: 4px;
  }
  .proof-note { font-size: 10px; color: var(--muted); }

  .proof-badges {
    display: flex;
    justify-content: center;
    gap: 8px;
    flex-wrap: wrap;
    margin-top: 12px;
  }

  .proof-badge {
    padding: 4px 10px;
    border-radius: 1px;
    font-size: 10px;
    letter-spacing: 1px;
  }

  .proof-badge.green { background: rgba(0,255,136,0.1); border: 1px solid var(--green); color: var(--green); }
  .proof-badge.gold { background: rgba(255,204,68,0.1); border: 1px solid var(--gold); color: var(--gold); }

  /* ===================== SUBMISSION ===================== */
  .submission-card {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 80px;
  }

  .sub-header {
    background: rgba(0,255,136,0.06);
    border-bottom: 1px solid var(--border);
    padding: 24px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: gap;
    gap: 16px;
  }

  .sub-title {
    font-family: 'DM Serif Display', serif;
    font-size: 24px;
    color: #fff;
  }

  .sub-amount {
    font-family: 'DM Serif Display', serif;
    font-size: 36px;
    color: var(--gold);
    text-shadow: 0 0 30px rgba(255,204,68,0.5);
  }

  .sub-body { padding: 32px; }

  .checklist { list-style: none; }
  .checklist li {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 10px 0;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    font-size: 13px;
  }

  .checklist li:last-child { border-bottom: none; }

  .check-icon {
    width: 20px; height: 20px;
    border-radius: 50%;
    background: rgba(0,255,136,0.1);
    border: 1px solid var(--green);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--green);
    font-size: 11px;
    flex-shrink: 0;
    margin-top: 1px;
  }

  .check-text { color: var(--text); flex: 1; }
  .check-note { font-size: 11px; color: var(--muted); margin-top: 2px; }

  /* ===================== HOW TO SUBMIT ===================== */
  .submit-steps {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 40px;
  }

  .submit-step {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 24px;
    position: relative;
  }

  .step-num {
    font-family: 'DM Serif Display', serif;
    font-size: 48px;
    color: rgba(255,255,255,0.05);
    position: absolute;
    top: 8px; right: 16px;
    line-height: 1;
  }

  .step-icon { font-size: 24px; margin-bottom: 12px; }
  .step-name { font-size: 14px; color: #fff; margin-bottom: 6px; }
  .step-detail { font-size: 11px; color: var(--muted); line-height: 1.7; }

  .submit-url {
    background: rgba(0,0,0,0.5);
    border: 1px solid rgba(0,212,255,0.3);
    border-radius: 2px;
    padding: 20px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    flex-wrap: wrap;
  }

  .submit-url-label { font-size: 11px; color: var(--muted); letter-spacing: 2px; text-transform: uppercase; }
  .submit-url-link {
    font-family: 'Space Mono', monospace;
    font-size: 13px;
    color: var(--cyan);
    text-decoration: none;
    border-bottom: 1px solid rgba(0,212,255,0.3);
    padding-bottom: 2px;
    transition: border-color 0.2s;
  }

  .submit-url-link:hover { border-color: var(--cyan); }

  /* ===================== FOOTER ===================== */
  footer {
    border-top: 1px solid var(--border);
    padding: 32px 0;
    text-align: center;
    color: var(--muted);
    font-size: 12px;
    letter-spacing: 1px;
  }

  footer strong { color: var(--green); }

  /* ===================== LOADING ANIMATION ===================== */
  .processing {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 11px;
    color: var(--cyan);
  }

  .spinner {
    width: 14px; height: 14px;
    border: 2px solid rgba(0,212,255,0.2);
    border-top-color: var(--cyan);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  /* Scroll reveal */
  .reveal { opacity: 0; transform: translateY(24px); transition: all 0.6s ease; }
  .reveal.visible { opacity: 1; transform: translateY(0); }

  section { padding: 60px 0; }

  .divider {
    border: none;
    border-top: 1px solid var(--border);
    margin: 0;
  }
</style>
</head>
<body>

<canvas id="matrixCanvas"></canvas>

<div class="container">
  <!-- HERO -->
  <header>
    <div class="badge">
      <span class="badge-dot"></span>
      Built for Zama Developer Program ¬∑ February 2026
    </div>
    <h1>Confidential<br><em>Payroll</em></h1>
    <p class="tagline">The world's first truly confidential on-chain payroll ¬∑ Powered by <span>Zama fhEVM</span></p>

    <div class="prize-strip">
      <div class="prize-item">
        <div class="prize-val">$5,000</div>
        <div class="prize-label">Special Bounty Prize</div>
      </div>
      <div class="prize-item">
        <div class="prize-val">4</div>
        <div class="prize-label">Smart Contracts</div>
      </div>
      <div class="prize-item">
        <div class="prize-val">1,800+</div>
        <div class="prize-label">Lines of Solidity</div>
      </div>
      <div class="prize-item">
        <div class="prize-val">12+</div>
        <div class="prize-label">FHE Operations</div>
      </div>
    </div>
  </header>

  <hr class="divider">

  <!-- LIVE DEMO -->
  <section class="reveal">
    <div class="section-label">// Interactive Demo</div>
    <h2 class="section-title">Try the FHE Payroll Flow</h2>
    <p class="section-sub">Experience how salaries are encrypted, processed, and verified ‚Äî all without anyone seeing the actual amounts.</p>

    <div class="demo-wrapper">
      <div class="demo-header">
        <span class="demo-dot r"></span>
        <span class="demo-dot y"></span>
        <span class="demo-dot g"></span>
        <span class="demo-title">CONFIDENTIAL_PAYROLL_DEMO.SOL ‚Äî ZAMA SEPOLIA TESTNET</span>
      </div>

      <div class="demo-body">
        <!-- LEFT: Controls -->
        <div class="demo-controls">
          <div class="step-indicator" id="stepIndicator">
            <div class="step-dot active" onclick="goStep(0)"></div>
            <div class="step-dot" onclick="goStep(1)"></div>
            <div class="step-dot" onclick="goStep(2)"></div>
            <div class="step-dot" onclick="goStep(3)"></div>
          </div>

          <!-- Step 0: Add Employee -->
          <div class="step-panel" id="step0">
            <div class="step-title">Add Employee</div>
            <div class="step-desc">The employer adds an employee with their salary. The salary is encrypted client-side using <strong>fhevmjs</strong> before it ever leaves the browser.</div>
            <div class="field-group">
              <div class="field-label">Employee Wallet Address</div>
              <input type="text" class="field-input" id="empAddr" value="0x71C7656EC7ab88b098defB751B7401B5f6d8976F" placeholder="0x...">
            </div>
            <div class="field-group">
              <div class="field-label">Monthly Salary (USD)</div>
              <input type="number" class="field-input" id="empSalary" value="12000" placeholder="12000">
            </div>
            <div class="field-group">
              <div class="field-label">Department</div>
              <select class="field-select field-input" id="empDept">
                <option value="1">Engineering</option>
                <option value="2">Product</option>
                <option value="3">Design</option>
                <option value="4">Operations</option>
              </select>
            </div>
            <button class="btn-primary" onclick="runStep0()">üîê Encrypt & Add Employee</button>
          </div>

          <!-- Step 1: Run Payroll -->
          <div class="step-panel" id="step1" style="display:none">
            <div class="step-title">Run Monthly Payroll</div>
            <div class="step-desc">The payroll manager triggers the run. Tax, bonus, and deductions are calculated entirely on <strong>encrypted data</strong> using FHE operations ‚Äî no plaintext ever seen.</div>
            <div class="field-group">
              <div class="field-label">One-Time Bonus</div>
              <input type="number" class="field-input" id="empBonus" value="2000" placeholder="0">
            </div>
            <div class="field-group">
              <div class="field-label">Deductions (401k etc.)</div>
              <input type="number" class="field-input" id="empDeduct" value="500" placeholder="0">
            </div>
            <button class="btn-primary" onclick="runStep1()">‚ö° Execute FHE Payroll</button>
          </div>

          <!-- Step 2: Employee Decrypt -->
          <div class="step-panel" id="step2" style="display:none">
            <div class="step-title">Employee Decrypts Pay</div>
            <div class="step-desc">The employee requests threshold decryption via the <strong>Zama Gateway</strong>. Only they can decrypt their own salary ‚Äî not even the admin can see it.</div>
            <button class="btn-primary" onclick="runStep2()">üîë Request Gateway Decryption</button>
          </div>

          <!-- Step 3: Payslip Proof -->
          <div class="step-panel" id="step3" style="display:none">
            <div class="step-title">Generate Payslip Proof</div>
            <div class="step-desc">The employee proves to a bank that their salary is <strong>in a range</strong> ‚Äî without revealing the exact amount. A Soulbound NFT is minted as cryptographic proof.</div>
            <div class="field-group">
              <div class="field-label">Verifier (Bank Address)</div>
              <input type="text" class="field-input" value="0xFNB...FirstNationalBank" readonly>
            </div>
            <div class="field-group">
              <div class="field-label">Salary Range to Prove</div>
              <select class="field-select field-input">
                <option>$8,000 ‚Äì $25,000 / month</option>
                <option>$5,000 ‚Äì $15,000 / month</option>
              </select>
            </div>
            <button class="btn-primary" onclick="runStep3()">üìú Mint Payslip NFT</button>
          </div>
        </div>

        <!-- RIGHT: Visualization -->
        <div class="demo-visual">
          <div class="visual-label" id="visualLabel">// Awaiting input...</div>

          <!-- Cipher display -->
          <div class="cipher-box" id="cipherBox">
            <span class="cipher-tag plain">PLAINTEXT</span>
            <span id="cipherContent" style="color:var(--gold)">Waiting for input...</span>
          </div>

          <!-- FHE ops chain -->
          <div class="fhe-chain" id="fheChain" style="display:none">
            <div class="fhe-op" id="fheOp0">
              <div class="fhe-op-icon">+</div>
              <div class="fhe-op-text">
                <div class="fhe-op-name">Gross Pay</div>
                <div class="fhe-op-code">TFHE.add(salary, bonus)</div>
              </div>
            </div>
            <div class="fhe-op" id="fheOp1">
              <div class="fhe-op-icon">%</div>
              <div class="fhe-op-text">
                <div class="fhe-op-name">Progressive Tax</div>
                <div class="fhe-op-code">TFHE.min() ¬∑ TFHE.select()</div>
              </div>
            </div>
            <div class="fhe-op" id="fheOp2">
              <div class="fhe-op-icon">‚àí</div>
              <div class="fhe-op-text">
                <div class="fhe-op-name">Net Pay</div>
                <div class="fhe-op-code">TFHE.sub(gross, deductions)</div>
              </div>
            </div>
            <div class="fhe-op" id="fheOp3">
              <div class="fhe-op-icon">ü™ô</div>
              <div class="fhe-op-text">
                <div class="fhe-op-name">Mint ERC-7984 Token</div>
                <div class="fhe-op-code">payToken.mint(employee, netPay)</div>
              </div>
            </div>
          </div>

          <!-- Result panel -->
          <div class="result-panel" id="resultPanel"></div>
        </div>
      </div>
    </div>
  </section>

  <hr class="divider">

  <!-- ARCHITECTURE -->
  <section class="reveal">
    <div class="section-label">// Smart Contracts</div>
    <h2 class="section-title">4 Contracts. One System.</h2>
    <p class="section-sub">Every component designed around a single principle: nobody sees salaries except the employee themselves.</p>

    <div class="arch-grid">
      <div class="contract-card">
        <div class="contract-icon">üèóÔ∏è</div>
        <div class="contract-name">ConfidentialPayroll</div>
        <div class="contract-lines">644 LINES ¬∑ CORE CONTRACT</div>
        <div class="contract-desc">The engine. Manages employees, runs payroll with branchless FHE tax calculation, integrates Gateway for threshold decryption.</div>
        <div class="contract-ops">
          <span class="op-tag">TFHE.add()</span>
          <span class="op-tag">TFHE.sub()</span>
          <span class="op-tag">TFHE.mul()</span>
          <span class="op-tag">TFHE.min()</span>
          <span class="op-tag">TFHE.select()</span>
          <span class="op-tag">Gateway</span>
        </div>
      </div>

      <div class="contract-card payslip">
        <div class="contract-icon">üìã</div>
        <div class="contract-name">ConfidentialPayslip</div>
        <div class="contract-lines">548 LINES ¬∑ INCOME VERIFICATION</div>
        <div class="contract-desc">The decisive feature. Proves salary ranges to banks and landlords via FHE boolean proofs, without revealing exact amounts. Soulbound ERC-5192 NFTs.</div>
        <div class="contract-ops">
          <span class="op-tag">TFHE.ge()</span>
          <span class="op-tag">TFHE.le()</span>
          <span class="op-tag">TFHE.and()</span>
          <span class="op-tag">ERC-5192</span>
        </div>
      </div>

      <div class="contract-card oracle">
        <div class="contract-icon">‚öñÔ∏è</div>
        <div class="contract-name">ConfidentialEquityOracle</div>
        <div class="contract-lines">PAY EQUITY COMPLIANCE</div>
        <div class="contract-desc">Proves EU Pay Transparency Directive compliance ‚Äî gender pay gap, salary bands ‚Äî all computed on encrypted data. Zero individual disclosure.</div>
        <div class="contract-ops">
          <span class="op-tag">TFHE.gt()</span>
          <span class="op-tag">TFHE.lt()</span>
          <span class="op-tag">EU Directive</span>
        </div>
      </div>

      <div class="contract-card token">
        <div class="contract-icon">ü™ô</div>
        <div class="contract-name">ConfidentialPayToken</div>
        <div class="contract-lines">ERC-7984 ¬∑ SALARY TOKEN</div>
        <div class="contract-desc">Employees receive real ERC-7984 tokens representing their encrypted net pay. Transferable salary with privacy guarantees baked in at the token level.</div>
        <div class="contract-ops">
          <span class="op-tag">ERC-7984</span>
          <span class="op-tag">euint64</span>
          <span class="op-tag">TFHE.allow()</span>
        </div>
      </div>
    </div>
  </section>

  <hr class="divider">

  <!-- PAYSLIP DEMO -->
  <section class="reveal">
    <div class="section-label">// The Decisive Feature</div>
    <h2 class="section-title">Real-World Income Verification</h2>
    <p class="section-sub">No other FHE payroll system solves this: employees need to prove income to banks without revealing their exact salary.</p>

    <div class="payslip-demo">
      <div class="payslip-grid">
        <div class="payslip-party">
          <div class="party-icon">üë©‚Äçüíª</div>
          <div class="party-name">Alice (Employee)</div>
          <div class="party-desc">Salary: <span style="color:var(--cyan)">‚òÖ ENCRYPTED ‚òÖ</span><br>Wants a mortgage</div>
        </div>

        <div>
          <div class="payslip-arrow">‚Üí</div>
          <div style="margin:12px 0">
            <div class="proof-box">
              <div class="proof-title">FHE RANGE PROOF</div>
              <div class="proof-range">$8k ‚Äì $25k</div>
              <div class="proof-note">Monthly salary range assertion</div>
              <div class="proof-badges">
                <span class="proof-badge green">‚úì VERIFIED ON-CHAIN</span>
                <span class="proof-badge gold">Soulbound NFT</span>
              </div>
            </div>
          </div>
          <div class="payslip-arrow">‚Üí</div>
        </div>

        <div class="payslip-party">
          <div class="party-icon">üè¶</div>
          <div class="party-name">First National Bank</div>
          <div class="party-desc">Sees: salary ‚àà [$8k, $25k]<br><span style="color:var(--green)">Loan approved ‚úì</span></div>
        </div>
      </div>

      <div style="margin-top:24px;padding-top:24px;border-top:1px solid var(--border);text-align:center">
        <div style="font-size:12px;color:var(--muted);margin-bottom:8px">Exact salary: permanently encrypted. Never seen by anyone ‚Äî not the bank, not the employer, not Zama.</div>
        <div style="display:flex;justify-content:center;gap:16px;flex-wrap:wrap;font-size:11px;font-family:'Space Mono',monospace;color:var(--cyan)">
          <span>TFHE.ge(salary, min)</span>
          <span>AND</span>
          <span>TFHE.le(salary, max)</span>
          <span>‚Üí</span>
          <span style="color:var(--green)">ebool = true</span>
        </div>
      </div>
    </div>
  </section>

  <hr class="divider">

  <!-- SUBMISSION CHECKLIST -->
  <section class="reveal">
    <div class="section-label">// Competition Entry</div>
    <h2 class="section-title">Submission Checklist</h2>

    <div class="submission-card">
      <div class="sub-header">
        <div>
          <div class="sub-title">Zama Special Bounty: Confidential Onchain Payroll</div>
          <div style="font-size:12px;color:var(--muted);margin-top:4px">+ Core team support to take it from 0 to 1</div>
        </div>
        <div class="sub-amount">$5,000</div>
      </div>

      <div class="sub-body">
        <ul class="checklist">
          <li>
            <div class="check-icon">‚úì</div>
            <div class="check-text">
              <strong>Real FHE Implementation ‚Äî Not Mocks</strong>
              <div class="check-note">Uses actual TFHE operations on encrypted euint64 data throughout. No TFHE.decrypt() inside logic ‚Äî fully branchless.</div>
            </div>
          </li>
          <li>
            <div class="check-icon">‚úì</div>
            <div class="check-text">
              <strong>Progressive Tax on Encrypted Data</strong>
              <div class="check-note">TFHE.min() + TFHE.select() branchless algorithm ‚Äî the most complex FHE logic in any payroll submission.</div>
            </div>
          </li>
          <li>
            <div class="check-icon">‚úì</div>
            <div class="check-text">
              <strong>Verifiable Payslips (ConfidentialPayslip.sol)</strong>
              <div class="check-note">FHE range proofs ‚Üí Soulbound ERC-5192 NFTs. No other submission solves real-world income verification.</div>
            </div>
          </li>
          <li>
            <div class="check-icon">‚úì</div>
            <div class="check-text">
              <strong>ERC-7984 Salary Token (ConfidentialPayToken.sol)</strong>
              <div class="check-note">Employees receive actual transferable tokens representing encrypted net pay.</div>
            </div>
          </li>
          <li>
            <div class="check-icon">‚úì</div>
            <div class="check-text">
              <strong>Pay Equity Oracle (ConfidentialEquityOracle.sol)</strong>
              <div class="check-note">EU Pay Transparency Directive compliance proofs computed entirely on encrypted salaries.</div>
            </div>
          </li>
          <li>
            <div class="check-icon">‚úì</div>
            <div class="check-text">
              <strong>Zama Gateway Threshold Decryption</strong>
              <div class="check-note">Full Gateway integration with async callbacks for employee-only salary decryption.</div>
            </div>
          </li>
          <li>
            <div class="check-icon">‚úì</div>
            <div class="check-text">
              <strong>Role-Based Access Control (OpenZeppelin)</strong>
              <div class="check-note">Admin, Payroll Manager, Auditor, Employee roles ‚Äî production-grade security.</div>
            </div>
          </li>
          <li>
            <div class="check-icon">‚úì</div>
            <div class="check-text">
              <strong>Complete Test Suite + Deployment Scripts</strong>
              <div class="check-note">One-command deploy to Zama Sepolia. 10+ test scenarios. Full coverage.</div>
            </div>
          </li>
          <li>
            <div class="check-icon">‚úì</div>
            <div class="check-text">
              <strong>fhevmjs Frontend Integration</strong>
              <div class="check-note">Client-side encryption with fhevmjs. Employer never sees plaintext salary.</div>
            </div>
          </li>
          <li>
            <div class="check-icon">‚úì</div>
            <div class="check-text">
              <strong>Comprehensive Documentation (5+ docs)</strong>
              <div class="check-note">README, ARCHITECTURE.md, FHE_OPERATIONS.md, PAYSLIP.md, ZAMA_SUBMISSION.md</div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </section>

  <hr class="divider">

  <!-- HOW TO SUBMIT -->
  <section class="reveal">
    <div class="section-label">// How to Submit</div>
    <h2 class="section-title">Submission Steps</h2>

    <div class="submit-steps">
      <div class="submit-step">
        <div class="step-num">1</div>
        <div class="step-icon">üìÅ</div>
        <div class="step-name">Push to GitHub</div>
        <div class="step-detail">Create a public GitHub repository. Push the full ConfidentialPayroll project. Make sure the repo is public and README is clear.</div>
      </div>

      <div class="submit-step">
        <div class="step-num">2</div>
        <div class="step-icon">üöÄ</div>
        <div class="step-name">Deploy to Zama Sepolia</div>
        <div class="step-detail">Run <code style="color:var(--cyan)">npx hardhat run scripts/deploy.js --network zama-sepolia</code> and record your contract addresses.</div>
      </div>

      <div class="submit-step">
        <div class="step-num">3</div>
        <div class="step-icon">üé¨</div>
        <div class="step-name">Record Demo Video</div>
        <div class="step-detail">Short 3‚Äì5 min video showing: adding employees, running payroll, decrypting salary via Gateway, generating a payslip NFT.</div>
      </div>

      <div class="submit-step">
        <div class="step-num">4</div>
        <div class="step-icon">üìù</div>
        <div class="step-name">Fill Submission Form</div>
        <div class="step-detail">Submit via the official Zama form with GitHub URL, deployed contract address, video link, and brief description.</div>
      </div>
    </div>

    <div class="submit-url">
      <div>
        <div class="submit-url-label">üèÜ Official Submission Form ‚Äî Special Bounty</div>
        <div style="font-size:11px;color:var(--muted);margin-top:4px">Confidential Onchain Payroll ¬∑ $5,000 Reward</div>
      </div>
      <a class="submit-url-link" href="https://forms.zama.org/developer-program-startup-track" target="_blank">
        forms.zama.org/developer-program-startup-track ‚Üí
      </a>
    </div>

    <div style="margin-top:16px;padding:16px 20px;background:rgba(255,204,68,0.05);border:1px solid rgba(255,204,68,0.2);border-radius:2px">
      <div style="font-size:12px;color:var(--gold);margin-bottom:8px">‚ö†Ô∏è Important ‚Äî Fill in ZAMA_SUBMISSION.md before submitting:</div>
      <div style="font-size:11px;color:var(--muted);line-height:1.8">
        Replace <code style="color:var(--cyan)">[Your Name]</code>, <code style="color:var(--cyan)">[Your Email]</code>, <code style="color:var(--cyan)">[Your Discord Handle]</code> and the GitHub repo URL with your real info.<br>
        Add your deployed contract address to the Appendix section of ZAMA_SUBMISSION.md.
      </div>
    </div>
  </section>

  <footer>
    <strong>ConfidentialPayroll v2.1</strong> ¬∑ Built for Zama Developer Program ¬∑ February 2026<br>
    <span style="margin-top:8px;display:block">Making payroll truly confidential for the first time in history ¬∑ Powered by Zama fhEVM</span>
  </footer>
</div>

<script>
// ===================== MATRIX RAIN =====================
const canvas = document.getElementById('matrixCanvas');
const ctx = canvas.getContext('2d');

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdef0123456789!@#$%^&*()_+-=[]{}|;:,.<>?‚Ç¨¬£¬•Œ±Œ≤Œ≥Œ¥ŒµŒ∂Œ∑Œ∏‚àë‚àè‚à´‚àÇ‚àá';
const fontSize = 13;
let drops = [];

function initDrops() {
  const cols = Math.floor(canvas.width / fontSize);
  drops = Array(cols).fill(1);
}
initDrops();

function drawMatrix() {
  ctx.fillStyle = 'rgba(3,5,8,0.05)';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = '#00ff88';
  ctx.font = `${fontSize}px monospace`;
  drops.forEach((y, i) => {
    const c = chars[Math.floor(Math.random() * chars.length)];
    ctx.fillText(c, i * fontSize, y * fontSize);
    if (y * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
    drops[i]++;
  });
}

setInterval(drawMatrix, 50);

// ===================== CIPHER ANIMATION =====================
function animateCipher(plaintext, duration = 1200) {
  const box = document.getElementById('cipherBox');
  const content = document.getElementById('cipherContent');
  const tag = box.querySelector('.cipher-tag');

  tag.textContent = 'ENCRYPTING...';
  tag.className = 'cipher-tag computing';
  box.className = 'cipher-box encrypting';

  const chars2 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdef0123456789+/=';
  const targetLen = 88;
  let frame = 0;
  const totalFrames = duration / 40;

  const interval = setInterval(() => {
    frame++;
    const progress = frame / totalFrames;

    if (progress < 0.7) {
      // Scramble phase
      content.style.color = 'var(--cyan)';
      content.textContent = Array.from({length: targetLen}, () =>
        chars2[Math.floor(Math.random() * chars2.length)]
      ).join('');
    } else {
      // Settle to hex
      content.style.color = 'var(--green)';
      content.textContent = '0x' + Array.from({length: 62}, () =>
        Math.floor(Math.random() * 16).toString(16)
      ).join('') + '...';
    }

    if (frame >= totalFrames) {
      clearInterval(interval);
      tag.textContent = 'FHE ENCRYPTED';
      tag.className = 'cipher-tag enc';
      box.className = 'cipher-box done-encrypt';
    }
  }, 40);
}

// ===================== DEMO STEPS =====================
let currentStep = 0;
let salary = 12000;
let bonus = 2000;
let deduction = 500;

function goStep(n) {
  if (n > currentStep) return; // can't skip forward
  // just navigate back
  for (let i = 0; i <= 3; i++) {
    document.getElementById('step' + i).style.display = i === n ? 'block' : 'none';
  }
  updateStepIndicator(n);
  currentStep = n;
}

function updateStepIndicator(active) {
  document.querySelectorAll('.step-dot').forEach((dot, i) => {
    dot.className = 'step-dot' + (i < active ? ' done' : i === active ? ' active' : '');
  });
}

function showStep(n) {
  for (let i = 0; i <= 3; i++) {
    document.getElementById('step' + i).style.display = i === n ? 'block' : 'none';
  }
  updateStepIndicator(n);
  currentStep = n;
}

async function runStep0() {
  salary = parseInt(document.getElementById('empSalary').value) || 12000;
  const addr = document.getElementById('empAddr').value;
  const dept = document.getElementById('empDept').value;

  document.getElementById('visualLabel').textContent = '// Encrypting salary client-side with fhevmjs...';
  document.getElementById('resultPanel').className = 'result-panel';
  document.getElementById('fheChain').style.display = 'none';

  const btn = event.target;
  btn.disabled = true;
  btn.textContent = '‚è≥ Encrypting...';

  animateCipher(salary);

  await sleep(1600);

  document.getElementById('visualLabel').textContent = '// Employee registered on-chain ‚úì';
  document.getElementById('resultPanel').className = 'result-panel visible';
  document.getElementById('resultPanel').innerHTML = `
    <div class="result-row"><span class="result-key">Employee</span><span class="result-val">${addr.slice(0,10)}...${addr.slice(-6)}</span></div>
    <div class="result-row"><span class="result-key">Salary</span><span class="result-val encrypted">0x${rndHex(14)}... (encrypted)</span></div>
    <div class="result-row"><span class="result-key">Department</span><span class="result-val">${['','Engineering','Product','Design','Operations'][dept]}</span></div>
    <div class="result-row"><span class="result-key">Tx Hash</span><span class="result-val encrypted">0x${rndHex(20)}...</span></div>
    <div class="result-row"><span class="result-key">Status</span><span class="result-val">‚úì Active</span></div>
  `;

  btn.disabled = false;
  btn.textContent = 'üîê Encrypt & Add Employee';

  await sleep(400);
  showStep(1);
}

async function runStep1() {
  bonus = parseInt(document.getElementById('empBonus').value) || 0;
  deduction = parseInt(document.getElementById('empDeduct').value) || 0;

  document.getElementById('visualLabel').textContent = '// Running FHE payroll calculations...';
  document.getElementById('resultPanel').className = 'result-panel';
  document.getElementById('fheChain').style.display = 'flex';

  const ops = ['fheOp0','fheOp1','fheOp2','fheOp3'];
  ops.forEach(id => document.getElementById(id).className = 'fhe-op');

  const btn = event.target;
  btn.disabled = true;
  btn.textContent = '‚ö° Computing on encrypted data...';

  // Animate each FHE op
  for (let i = 0; i < ops.length; i++) {
    document.getElementById(ops[i]).className = 'fhe-op active';
    await sleep(700);
    document.getElementById(ops[i]).className = 'fhe-op done';
  }

  // Calculate results
  const gross = salary + bonus;
  const taxRate = gross > 15000 ? 0.28 : gross > 10000 ? 0.22 : 0.12;
  const tax = Math.floor(gross * taxRate);
  const totalDeduct = deduction + tax;
  const net = Math.max(0, gross - totalDeduct);

  document.getElementById('visualLabel').textContent = '// Payroll run complete ‚Äî all amounts remain encrypted ‚úì';
  document.getElementById('resultPanel').className = 'result-panel visible';
  document.getElementById('resultPanel').innerHTML = `
    <div class="result-row"><span class="result-key">Gross Pay (euint64)</span><span class="result-val encrypted">0x${rndHex(14)}... (enc)</span></div>
    <div class="result-row"><span class="result-key">Tax (euint64)</span><span class="result-val encrypted">0x${rndHex(14)}... (enc)</span></div>
    <div class="result-row"><span class="result-key">Net Pay (euint64)</span><span class="result-val encrypted">0x${rndHex(14)}... (enc)</span></div>
    <div class="result-row"><span class="result-key">CPT Tokens Minted</span><span class="result-val encrypted">euint64 ‚Üí employee wallet</span></div>
    <div class="result-row"><span class="result-key">Admin sees amounts?</span><span class="result-val" style="color:var(--red)">‚úó NEVER</span></div>
  `;

  btn.disabled = false;
  btn.textContent = '‚ö° Execute FHE Payroll';

  await sleep(400);
  showStep(2);
}

async function runStep2() {
  document.getElementById('visualLabel').textContent = '// Requesting threshold decryption via Zama Gateway...';
  document.getElementById('resultPanel').className = 'result-panel';

  const btn = event.target;
  btn.disabled = true;
  btn.textContent = '‚è≥ Gateway processing...';

  // Animate decryption
  const box = document.getElementById('cipherBox');
  const content = document.getElementById('cipherContent');
  const tag = box.querySelector('.cipher-tag');

  box.className = 'cipher-box encrypting';
  tag.textContent = 'DECRYPTING...';
  tag.className = 'cipher-tag computing';
  content.style.color = 'var(--cyan)';

  const gross = salary + bonus;
  const taxRate = gross > 15000 ? 0.28 : gross > 10000 ? 0.22 : 0.12;
  const tax = Math.floor(gross * taxRate);
  const net = Math.max(0, gross - deduction - tax);

  // Scramble then reveal to employee
  for (let i = 0; i < 20; i++) {
    content.textContent = '0x' + Array.from({length: 20}, () =>
      Math.floor(Math.random() * 16).toString(16)).join('') + '...';
    await sleep(80);
  }

  // Reveal only to employee
  content.textContent = `$${net.toLocaleString()}/month`;
  content.style.color = 'var(--gold)';
  box.className = 'cipher-box done-encrypt';
  tag.textContent = 'DECRYPTED (EMPLOYEE ONLY)';
  tag.className = 'cipher-tag plain';

  await sleep(400);

  document.getElementById('visualLabel').textContent = '// Salary decrypted for employee only ‚úì';
  document.getElementById('resultPanel').className = 'result-panel visible';
  document.getElementById('resultPanel').innerHTML = `
    <div class="result-row"><span class="result-key">Gateway Request</span><span class="result-val">‚úì Completed</span></div>
    <div class="result-row"><span class="result-key">Employee sees</span><span class="result-val gold">$${net.toLocaleString()}/mo net</span></div>
    <div class="result-row"><span class="result-key">Admin sees</span><span class="result-val" style="color:var(--red)">‚úó Nothing</span></div>
    <div class="result-row"><span class="result-key">On-chain</span><span class="result-val encrypted">Still encrypted</span></div>
  `;

  btn.disabled = false;
  btn.textContent = 'üîë Request Gateway Decryption';

  await sleep(400);
  showStep(3);
}

async function runStep3() {
  document.getElementById('visualLabel').textContent = '// Computing FHE range proof...';
  document.getElementById('resultPanel').className = 'result-panel';
  document.getElementById('fheChain').style.display = 'flex';

  const ops = ['fheOp0','fheOp1','fheOp2','fheOp3'];
  ops.forEach(id => document.getElementById(id).className = 'fhe-op');

  // Update op labels for payslip
  document.getElementById('fheOp0').querySelector('.fhe-op-name').textContent = 'Lower Bound Check';
  document.getElementById('fheOp0').querySelector('.fhe-op-code').textContent = 'TFHE.ge(salary, min)';
  document.getElementById('fheOp1').querySelector('.fhe-op-name').textContent = 'Upper Bound Check';
  document.getElementById('fheOp1').querySelector('.fhe-op-code').textContent = 'TFHE.le(salary, max)';
  document.getElementById('fheOp2').querySelector('.fhe-op-name').textContent = 'AND Gate';
  document.getElementById('fheOp2').querySelector('.fhe-op-code').textContent = 'TFHE.and(lower, upper)';
  document.getElementById('fheOp3').querySelector('.fhe-op-name').textContent = 'Mint Soulbound NFT';
  document.getElementById('fheOp3').querySelector('.fhe-op-code').textContent = '_mint(employee, ERC5192)';

  const btn = event.target;
  btn.disabled = true;
  btn.textContent = '‚è≥ Generating proof...';

  for (let i = 0; i < ops.length; i++) {
    document.getElementById(ops[i]).className = 'fhe-op active';
    await sleep(600);
    document.getElementById(ops[i]).className = 'fhe-op done';
  }

  document.getElementById('visualLabel').textContent = '// Payslip NFT minted ‚úì Bank can now verify.';
  document.getElementById('resultPanel').className = 'result-panel visible';
  document.getElementById('resultPanel').innerHTML = `
    <div class="result-row"><span class="result-key">Range Proof</span><span class="result-val">$8k ‚Äì $25k ‚úì</span></div>
    <div class="result-row"><span class="result-key">NFT Type</span><span class="result-val">Soulbound (ERC-5192)</span></div>
    <div class="result-row"><span class="result-key">Token ID</span><span class="result-val encrypted">#${Math.floor(Math.random()*9999) + 1}</span></div>
    <div class="result-row"><span class="result-key">Verifier Access</span><span class="result-val">Bank Only</span></div>
    <div class="result-row"><span class="result-key">Exact Salary Revealed</span><span class="result-val" style="color:var(--red)">‚úó NEVER</span></div>
    <div class="result-row"><span class="result-key">Loan Decision</span><span class="result-val">‚úì Approved</span></div>
  `;

  // Reset op labels
  document.getElementById('fheOp0').querySelector('.fhe-op-name').textContent = 'Gross Pay';
  document.getElementById('fheOp0').querySelector('.fhe-op-code').textContent = 'TFHE.add(salary, bonus)';
  document.getElementById('fheOp1').querySelector('.fhe-op-name').textContent = 'Progressive Tax';
  document.getElementById('fheOp1').querySelector('.fhe-op-code').textContent = 'TFHE.min() ¬∑ TFHE.select()';
  document.getElementById('fheOp2').querySelector('.fhe-op-name').textContent = 'Net Pay';
  document.getElementById('fheOp2').querySelector('.fhe-op-code').textContent = 'TFHE.sub(gross, deductions)';
  document.getElementById('fheOp3').querySelector('.fhe-op-name').textContent = 'Mint ERC-7984 Token';
  document.getElementById('fheOp3').querySelector('.fhe-op-code').textContent = 'payToken.mint(employee, netPay)';

  btn.disabled = false;
  btn.textContent = 'üìú Mint Payslip NFT';
}

// ===================== UTILS =====================
function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }
function rndHex(n) { return Array.from({length:n}, () => Math.floor(Math.random()*16).toString(16)).join(''); }

// ===================== SCROLL REVEAL =====================
const reveals = document.querySelectorAll('.reveal');
const observer = new IntersectionObserver((entries) => {
  entries.forEach(e => {
    if (e.isIntersecting) e.target.classList.add('visible');
  });
}, { threshold: 0.1 });
reveals.forEach(r => observer.observe(r));
</script>
</body>
</html>
